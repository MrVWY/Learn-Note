## 过期索引
一种会过期的索引，在索引过期之后，索引对应的数据会被删除 
```
db.collection.createIndex({ expireField: 1 }, { expireAfterSeconds: 3600 })
```

## 索引是不是越多越好

过多索引带来的问题
  1. 写入性能下降：每次写入（插入、更新、删除）操作时，MongoDB 需要更新相关字段的索引。索引越多，写入操作的开销就越大，导致写入速度变慢。特别是对于需要高写入性能的应用，过多的索引会成为瓶颈。
  2. 占用更多存储空间：每个索引都需要占用额外的磁盘空间。对于较大的集合，如果索引数量过多，会显著增加存储需求。
  3. 内存消耗：为了高效查询，MongoDB 会将常用的索引数据加载到内存中。如果索引过多且数据量大，会导致内存使用量增加，影响系统的整体性能。
  4. 查询优化复杂化：查询优化器在面对多个索引时，可能会花费额外的时间来决定使用哪个索引。对于复杂查询，多个索引反而会增加优化器的负担，可能会导致不必要的开销。

  索引应该谨慎使用，合理的数量可以提高查询性能，但过多的索引会影响写入性能、占用存储空间和增加内存消耗。因此，在设计和优化索引时，应权衡查询性能和写入性能，避免盲目创建过多的索引。

## 集群模式有哪几种
### 副本集（Replica Set）：用于高可用性和容灾。
### 分片集群（Sharded Cluster，sharding）：用于水平扩展，处理大规模数据。

在 MongoDB 的分片集群中，数据根据分片键被均匀地分布在不同的分片中，应用程序对数据库的查询操作是通过 mongos 来进行路由的。具体操作流程如下：
  1. 选择分片键：数据库管理员在创建分片集合时，必须为集合选择一个合适的分片键。分片键通常是集合中的一个字段，它用于确定文档应该存储在哪个分片中。选择合适的分片键非常重要，它会影响数据的均匀分布以及查询性能。
  2. 数据分片：根据分片键，MongoDB 会将数据分为若干个分片块（Chunk），并将这些块分布在不同的分片节点上。每个块包含一部分数据，并且有一个分片键范围。
  3. 查询路由：应用程序通过 mongos 向分片集群发送查询请求，mongos 根据配置服务器上的分片键信息确定哪些分片存储了相关数据，并将请求路由到相应的分片。
  4. 负载均衡：MongoDB 会监控每个分片的负载，并在必要时将数据块从一个分片移动到另一个分片，以保持负载均衡。

如何选择分片键  
选择分片键时需要考虑以下几点：  
  1. 写操作分布：分片键应确保写操作可以均匀分布在不同的分片上，避免热点数据导致某个分片负载过高。
  2. 查询效率：大部分查询应包含分片键，这样可以让 mongos 精确定位数据位置，减少跨分片查询的代价。
  3. 查询模式：分片键应基于应用的查询模式选择，确保查询能够高效执行。例如，若查询多按日期范围，则可以考虑以日期字段作为分片键。

例子:  
假设有一个电商网站的订单数据量非常大，无法通过单一服务器存储和处理，那么可以通过 MongoDB Sharding 来分片存储和处理这些数据。  
1. 创建一个分片集群：
  部署多个 MongoDB 实例作为分片。
  部署至少三个配置服务器来存储集群的元数据。
  部署一个或多个 mongos 进程，作为路由器。
2. 选择分片键：
  选择一个合理的分片键，例如 order_id 或 user_id，以便将数据均匀分布到各个分片。
3. 启动分片集群：
  启动所有分片节点、配置服务器和 mongos 路由器。
  通过 mongos 将数据插入数据库，mongos 会根据分片键和配置服务器的信息将数据分发到相应的分片。

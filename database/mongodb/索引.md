## 索引
- 单字段索引

- 复合索引：针对多个字段联合创建索引，先按第一个字段排序，第一个字段相同的文档按第二个字段排序

- 多 key 索引：当索引的字段为数组时，创建出的索引称为多 key 索引，多 key 索引会为数组的每个元素建立一条索引

- 过期索引: 一种会过期的索引，在索引过期之后，索引对应的数据会被删除
  + db.collection.createIndex({ expireField: 1 }, { expireAfterSeconds: 3600 })

- 文本(全文)索引：能解决快速文本查找的需求，比如有一个博客文章集合，需要根据博客的内容来快速查找，则可以针对博客内容建立文本索引

- 哈希索引：指按照某个字段的 hash 值来建立索引

- 地理位置索引：能很好的解决 O2O 的应用场景，比如查找附近的美食、查找某个区域内的车站等
  + 2d 索引: 可以用来存储和查找平面上的点, 一般可以用在游戏地图中
  + 2d sphere 索引: 适用于球面类型的地图，它的数据类型是GeoJSON格式的, 可以在http://geojson.org/地址上查看GeoJSON格式的样式  
    ```
    //描述点
    { 
    "_id" : ObjectId("59f5e0571f9e8e181ffc3196"),
    "name" : "shenzhen",
    "location" : { 
        "type" : "Point",
        "coordinates" : [ 
            90.0, 
            0.0
        ]
    }
    }
    //描述线
    { 
    "_id" : ObjectId("59f5e0d01f9e8e181ffc3199"),
    "name" : "shenzhen",
    "location" : { 
        "type" : "LineString",
        "coordinates" : [ 
            [ 
                90.0, 
                0.0
            ], 
            [ 
                90.0, 
                1.0
            ], 
            [ 
                90.0, 
                2.0
            ]
        ]
    }
    }
    ```
- 部分索引：
  ```
    只对rating字段大于5的文档进行索引
    db.restaurants.createIndex(
       { cuisine: 1, name: 1 },
       { partialFilterExpression: { rating: { $gt: 5 } } }
    )
  ```
- 稀疏索引（sparse index）: 仅包含具有索引字段的文档的条目，即使索引字段包含 null 值也是如此。该索引将跳过缺少索引字段的所有文档。索引是“稀疏”的，因为它不包括集合的所有文档。相比之下，非稀疏索引包含集合中的所有文档，为那些不包含索引字段的文档存储 null 值

## 索引失效
1. 查询条件不符合索引顺序
   MongoDB 中的复合索引是根据定义的字段顺序进行匹配的。如果查询条件中的字段顺序不符合索引的顺序，索引可能会失效

2. 查询中使用了 $not 或 $ne
   使用 $not、$ne（不等于）等运算符时，MongoDB 通常不会使用索引，因为这些操作符要求扫描整个数据集以排除不匹配的结果

3. 范围查询影响其他字段的索引
   如果一个查询使用了复合索引，并且其中一个字段使用了范围查询（如 $gt, $lt, $in），那么索引只能在这个字段`之前的字段`上有效，范围字段之后的字段无法再使用索引

4. 数据类型不一致
   MongoDB 是弱类型数据库，允许不同类型的数据存储在同一个字段中。然而，如果查询的字段类型与索引中的字段类型不一致，索引可能会失效

5. 使用 $or 查询
   在 $or 查询中，只有当每个分支都能匹配某个索引时，MongoDB 才会使用索引

## hint 
   强迫MongoDB使用一个特定的索引

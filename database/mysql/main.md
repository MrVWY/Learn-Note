## MyISAM 与 InnoDB 的区别

1. InnoDB支持事务，MyISAM不支持 
2. InnoDB 支持外键，而 MyISAM 不支持 
3. InnoDB是聚集索引，使用B+Tree作为索引结构，数据文件是和索引绑在一起的，必须要有主键。MyISAM是非聚集索引，也是使用B+Tree作为索引结构，索引和数据文件是分离的，索引保存的是数据文件的指针。主键索引和辅助索引是独立的 
4. InnoDB 不保存表的具体行数。MyISAM 用一个变量保存了整个表的行数 
5. Innodb 有 redolog 日志文件，MyISAM 没有 
6. Innodb存储文件有frm、ibd，而Myisam是frm、MYD、MYI
  - （1）Innodb：frm是表定义文件，ibd是数据文件
  - （2）Myisam：frm是表定义文件，myd是数据文件，myi是索引文件
7. InnoDB 支持表、行锁，而 MyISAM 支持表级锁
8. InnoDB 必须有唯一索引(主键),如果没有指定的话 InnoDB 会自己生成一个隐藏列Row_id来充当默认主键，MyISAM 可以没有

## WAl
WAL 就是 Write-Ahead Logging，其实就是「所有的修改都先被写入到日志中，然后再写磁盘」，用于保证数据操作的原子性和持久性  

好处:  
- （1）读和写可以完全地并发执行，不会互相阻塞
- （2）先写入log中，磁盘写入从随机写变成顺序写，降低了client端的延迟，并且，由于顺序写大概率是在一个磁盘内，这样产生的io次数也减少了

## 回表
回表是先通过数据库索引扫描出该索引树中数据所在的行，获取主键ID，在通过主键ID取出主键索引树中的数据，非主键索引的查询需要多扫描一次索引树

## 删除表数据后表的大小却没有变动,这是为什么?
在使用 delete 删除数据时，其实对应的数据行并不是真正的删除，是逻辑删除，InnoDB 仅仅是将其标记成可复用的状态，所以表空间不会变小

## 为什么 VarChar 建议不要超过255
1. 当定义varchar长度小于等于255时，长度标识位需要一个字节(utf-8编码)
2. 当大于255时，长度标识位需要两个字节，并且建立的索引也会失效

## 为什么不要使用长事务
1. 并发情况下，数据库连接池可能容易被撑爆 
2. 容易造成大量的阻塞和超时 
3. 执行时间长，可能造成主从延时 
4. 回滚时间较长，事务越长，整个时间段内的事务越多 
5. undolog 日志越来越大：长事务意味着系统里面会存在很老的事务视图。由于这些事务随时可能访问数据库里面的任何数据，所以这个事务提交之前，数据库里面它可能用到的回滚记录都必须保留，这就会导致大量占用存储空间

## Sql 调优思路
1. 表结构优化
   - 拆分字段
   - 字段类型的选择
   - 字段类型大小的限制
   - 合理的增加冗余字段
   - 新建字段一定要有默认值
2. 索引方面
   - 索引字段的选择
   - 利用好mysql支持的索引下推，覆盖索引等功能
   - 唯一索引和普通索引的选择
3. 查询语句方面
   - 避免索引失效
   - 合理的书写where条件字段顺序
   - 小表驱动大表
   - 可以使用force index()防止优化器选错索引
4. 分库分表
### mysql组成
- Server
- 存储引擎
### 索引类型
- 普通索引（INDEX，index）：是最基本的索引，它没有任何限制
- 唯一索引（UNIQUE,unique）：与普通索引类似，不同的就是：索引列的值必须唯一，但允许有空值。如果是组合索引，则列值的组合必须唯一
- 主键索引（PRIMARY KEY，primary key）：一种特殊的唯一索引，一个表只能有一个主键，不允许有空值。一般是在建表的时候同时创建主键索引
- 组合/复合/联合索引：指多个字段上创建的索引，只有在查询条件中使用了创建索引时的第一个字段，索引才会被使用。使用组合索引时遵循最左前缀集合
- 全文索引（FULLTEXT，fulltext）：主要用来查找文本中的关键字，而不是直接与索引中的值相比较

#### 最左前缀集合
当创建(a,b,c)复合索引时，想要索引生效的话，只能使用 a和ab、ac和abc三种组合的索引

### 回表
  通过二级索引找到B+树中的叶子结点，但是二级索引的叶子节点的内容并不全，只有索引列的值和主键值。这时候就
需要拿着主键值再去聚簇索引（主键索引）的叶子节点中去拿到完整的用户记录，这个过程叫做回表。
#### 回表代价
  二级索引叶子节点中的主键id的排布就没有任何规律了，毕竟二级索引的索引是对当前某个字段进行排序的。进行回表的时候，
极有可能出现主键id所在的记录在聚簇索引叶子节点中反复横跳的情况，也就是随机IO，甚至数据页还要从磁盘里面加载到内存里面查找

### 索引覆盖
  如果索引中已经包含了所有需要读取的列数据，那么就不需要回表操作，这就叫覆盖索引（或索引覆盖）

```
select id from t where age = 1;
1
id为主键，age为普通索引，age这个索引存储的就是主键id，可以直接返回数据
```

### 索引下推（index condition pushdown， ICP）
  索引下推能减少回表查询次数，提高查询效率  
例子：
```mysql
现在有一个联合索引为name和phone
1. SELECT * FROM user_innodb WHERE name = "小明" AND phone LIKE "%6606";
2. SELECT * FROM user_innodb WHERE phone LIKE "%6606" AND name = "小明";
```
注：索引的使用是在存储引擎中进行的，而数据记录的比较是在Server层中进行的
过程：
- 使用联合索引查出所有name为小明的二级索引数据/尾号为6606的二级索引数据
- 拿到主键索引进行回表，到聚簇索引中拿到这三条完整的用户记录；
- InnoDB把这3条完整的用户记录返回给MySQL的Server层，在Server层过滤出尾号为6606的用户/name为小明。

  因此，在极端情况下，在第一步查出来大量的数据，而且由于是查全部字段（SELECT * FROM...），还要进行回表，
那么就意味着要把这大量的数据传给server层处理，最后甚至就只有1条数据是符合条件的，
更重要的一点是还要进行回表，那么代价太大了。  
  如果引入索引下推（index condition pushdown， ICP），那么过滤的动作由下层的存储引擎层通过使用索引来完成，而不需要上推到Server层进行处理。
最终会把符合条件的数据回表查找，大大降低损耗，有效减少回表的次数。